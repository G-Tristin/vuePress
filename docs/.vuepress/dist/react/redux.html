<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>redux | 修罗之路</title>
    <meta name="description" content="做想做的事，爱想爱的人">
    
    
    <link rel="preload" href="/assets/css/0.styles.520e7122.css" as="style"><link rel="preload" href="/assets/js/app.e2e67a27.js" as="script"><link rel="preload" href="/assets/js/28.1a0cff41.js" as="script"><link rel="prefetch" href="/assets/js/10.17040d2c.js"><link rel="prefetch" href="/assets/js/11.65925a37.js"><link rel="prefetch" href="/assets/js/12.a6aa82ca.js"><link rel="prefetch" href="/assets/js/13.047df750.js"><link rel="prefetch" href="/assets/js/14.1f5bcaaa.js"><link rel="prefetch" href="/assets/js/15.5f253bde.js"><link rel="prefetch" href="/assets/js/16.4c222e00.js"><link rel="prefetch" href="/assets/js/17.c5c0d3f4.js"><link rel="prefetch" href="/assets/js/18.d4634f74.js"><link rel="prefetch" href="/assets/js/19.972b4802.js"><link rel="prefetch" href="/assets/js/2.d9c7c5e8.js"><link rel="prefetch" href="/assets/js/20.0997c38a.js"><link rel="prefetch" href="/assets/js/21.f3be93bc.js"><link rel="prefetch" href="/assets/js/22.59d0d40a.js"><link rel="prefetch" href="/assets/js/23.4a79d8a6.js"><link rel="prefetch" href="/assets/js/24.fd02f7a9.js"><link rel="prefetch" href="/assets/js/25.fcfb6698.js"><link rel="prefetch" href="/assets/js/26.e2c242d8.js"><link rel="prefetch" href="/assets/js/27.e30fd69c.js"><link rel="prefetch" href="/assets/js/29.1577b44d.js"><link rel="prefetch" href="/assets/js/3.62e29986.js"><link rel="prefetch" href="/assets/js/30.8102a796.js"><link rel="prefetch" href="/assets/js/31.f3f5b755.js"><link rel="prefetch" href="/assets/js/32.f7b546bb.js"><link rel="prefetch" href="/assets/js/33.987c16d1.js"><link rel="prefetch" href="/assets/js/34.e15f32d5.js"><link rel="prefetch" href="/assets/js/35.1250558a.js"><link rel="prefetch" href="/assets/js/4.7b202c41.js"><link rel="prefetch" href="/assets/js/5.f8de62e0.js"><link rel="prefetch" href="/assets/js/6.316f1abd.js"><link rel="prefetch" href="/assets/js/7.ef8b22af.js"><link rel="prefetch" href="/assets/js/8.6dad05a3.js"><link rel="prefetch" href="/assets/js/9.17cc79e3.js">
    <link rel="stylesheet" href="/assets/css/0.styles.520e7122.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">修罗之路</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/home/html5.html" class="nav-link">HTML</a></li><li class="dropdown-item"><!----> <a href="/home/css.html" class="nav-link">CSS</a></li><li class="dropdown-item"><!----> <a href="/home/javascript.html" class="nav-link">Javascript</a></li><li class="dropdown-item"><!----> <a href="/home/gulp.html" class="nav-link">Gulp</a></li><li class="dropdown-item"><!----> <a href="/home/webpack.html" class="nav-link">Webpack</a></li><li class="dropdown-item"><!----> <a href="/home/webpack.html" class="nav-link">polyfill</a></li></ul></div></div><div class="nav-item"><a href="/vue/" class="nav-link">Vue</a></div><div class="nav-item"><a href="/react/" class="nav-link router-link-active">React</a></div><div class="nav-item"><a href="/node/" class="nav-link">node</a></div><div class="nav-item"><a href="/ES6/" class="nav-link">ES6</a></div><div class="nav-item"><a href="/commander/" class="nav-link">命令行</a></div><div class="nav-item"><a href="https://github.com/G-Tristin/vue" target="_blank" rel="noopener noreferrer" class="nav-link external">
  gitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/home/html5.html" class="nav-link">HTML</a></li><li class="dropdown-item"><!----> <a href="/home/css.html" class="nav-link">CSS</a></li><li class="dropdown-item"><!----> <a href="/home/javascript.html" class="nav-link">Javascript</a></li><li class="dropdown-item"><!----> <a href="/home/gulp.html" class="nav-link">Gulp</a></li><li class="dropdown-item"><!----> <a href="/home/webpack.html" class="nav-link">Webpack</a></li><li class="dropdown-item"><!----> <a href="/home/webpack.html" class="nav-link">polyfill</a></li></ul></div></div><div class="nav-item"><a href="/vue/" class="nav-link">Vue</a></div><div class="nav-item"><a href="/react/" class="nav-link router-link-active">React</a></div><div class="nav-item"><a href="/node/" class="nav-link">node</a></div><div class="nav-item"><a href="/ES6/" class="nav-link">ES6</a></div><div class="nav-item"><a href="/commander/" class="nav-link">命令行</a></div><div class="nav-item"><a href="https://github.com/G-Tristin/vue" target="_blank" rel="noopener noreferrer" class="nav-link external">
  gitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/react/" class="sidebar-link">REACT</a></li><li><a href="/react/受控组件.html" class="sidebar-link">受控组件</a></li><li><a href="/react/状态提升与slot.html" class="sidebar-link">状态提升</a></li><li><a href="/react/redux.html" class="active sidebar-link">redux</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/react/redux.html#store的实现" class="sidebar-link">store的实现</a></li><li class="sidebar-sub-header"><a href="/react/redux.html#redux-中间件" class="sidebar-link">redux 中间件</a></li></ul></li></ul> </div> <div class="page"> <div class="content"><h1 id="redux"><a href="#redux" aria-hidden="true" class="header-anchor">#</a> redux</h1> <p><a href="http://www.ruanyifeng.com/blog/2016/09/redux_tutorial_part_one_basic_usages.html" target="_blank" rel="noopener noreferrer">参考文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>redux的流程分析</p> <p>一个完整的redux的实例</p> <div class="language- extra-class"><pre class="language-text"><code>import createStore form 'redux';
const state = {number:1}
const reducer = function(state,action){ //reducer函数可以理解为状态修改器
必须通过dispath来触发状态的修改 而状态具体要修改什么，则由action来决定 第一个参数为初始状态
  switch (action.type){
    case 'add':
      const number = state.number++
      return Object.assign({},state,{number})  //要引起状态改变必须返回一个完整的新的state对象 注意对象存在引用的问题
    default
      return
  }
}
const store = createStore(reducer);
action //是一个对象，当中必须要存在的一个属性是type用来代表这个action，相当于是这个action的名字
由于action可能会有多个，所以常见的用法是用一个函数构造action 方法如下
function createAction(type,text){
  return {
    type,
    text,
  }
}
const action = createAction('add','hello') // 创建了一个action
store.dispatch({ //触发reducer函数 告诉它需要状态修改 并且把要修改的内容当成参数传入
  type: 'ADD_TODO',
  payload: 'Learn Redux'
});
store.dispatch(createAction('add','aaa')) //是否可以通过这种方式来动态的创建action并提交修改
store.subscribe(()=&gt;{
  let newState = store.getState();
  component.setState(newState);
})
</code></pre></div><p>redux当中有2个必须要注意的点 1.action的函数化构造 2.reducer的拆分</p> <h3 id="如何实现reducer的拆分"><a href="#如何实现reducer的拆分" aria-hidden="true" class="header-anchor">#</a> 如何实现reducer的拆分</h3> <p>方法一：手动拆分</p> <p>拆分前</p> <div class="language- extra-class"><pre class="language-text"><code>const chatReducer = (state = defaultState, action = {}) =&gt; {
  const { type, payload } = action;
  switch (type) {
    case ADD_CHAT:
      return Object.assign({}, state, {
        chatLog: state.chatLog.concat(payload)
      });
    case CHANGE_STATUS:
      return Object.assign({}, state, {
        statusMessage: payload
      });
    case CHANGE_USERNAME:
      return Object.assign({}, state, {
        userName: payload
      });
    default: return state;
  }
};
</code></pre></div><p>拆分后</p> <div class="language- extra-class"><pre class="language-text"><code>function chatLog(state,action){
  ...
}
function statusMessage(state,action){
  ...
}
function userName(state,action){
  ...
}
const chatReducer = (state = defaultState, action = {}) =&gt; {
  return {
    chatLog: chatLog(state.chatLog, action),
    statusMessage: statusMessage(state.statusMessage, action),
    userName: userName(state.userName, action)
  }
};
</code></pre></div><p>方法2 ：使用内置方法</p> <p>Redux 提供了一个combineReducers方法，用于 Reducer 的拆分,你只要定义各个子 Reducer 函数，然后用这个方法，将它们合成一个大的 Reducer。</p> <div class="language- extra-class"><pre class="language-text"><code>import { combineReducers } from 'redux';

const chatReducer = combineReducers({
  chatLog,
  statusMessage,
  userName
})

export default todoApp;
</code></pre></div><p>这种写法有一个前提，就是 State 的属性名必须与子 Reducer 同名。如果不同名，就要采用下面的写法。</p> <div class="language- extra-class"><pre class="language-text"><code>const reducer = combineReducers({
  a: doSomethingWithA,
  b: processB,
  c: c
})

// 等同于
function reducer(state = {}, action) {
  return {
    a: doSomethingWithA(state.a, action),
    b: processB(state.b, action),
    c: c(state.c, action)
  }
}
</code></pre></div><h2 id="store的实现"><a href="#store的实现" aria-hidden="true" class="header-anchor">#</a> store的实现</h2> <ul><li>store.getState() ---获取当前状态</li> <li>store.dispatch() ---触发action</li> <li>store.subscribe() ---设置监听器,store一旦变化 就会调用监听器里的回调函数，一般写入setState()的函数或者render()函数</li></ul> <h2 id="redux-中间件"><a href="#redux-中间件" aria-hidden="true" class="header-anchor">#</a> redux 中间件</h2> <p>redux当中的中间件的作用就是给store.dispatch()添加功能</p> <p>中间件的使用：</p> <div class="language- extra-class"><pre class="language-text"><code>import { applyMiddleware, createStore } from 'redux';
import createLogger from 'redux-logger';
const logger = createLogger();

const store = createStore(
  reducer,
  applyMiddleware(logger)
);
</code></pre></div><p>虽然看起来中间件不是直接作用在sotre.dispatch上但是在源码当中，它作用的地方就是store.dispatch()</p> <p>中间件的主要作用是为了处理异步操作：</p> <p>异步操作的基本思路：</p> <p>异步需要3个action,请求前发送一个action 请求成功后一个action 请求失败后触发一个action 一共3个，同步只需要一个。</p> <ul><li>使用redux-thunk中间件</li> <li>使用redux-promise中间件</li></ul> <p>还是看<a href="http://www.ruanyifeng.com/blog/2016/09/redux_tutorial_part_two_async_operations.html" target="_blank" rel="noopener noreferrer">文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/react/状态提升与slot.html" class="prev">
          状态提升
        </a></span> <!----></p></div> </div> <!----></div></div>
    <script src="/assets/js/app.e2e67a27.js" defer></script><script src="/assets/js/28.1a0cff41.js" defer></script>
  </body>
</html>
